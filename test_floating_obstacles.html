<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>漂浮障碍物测试</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background-color: #2c3e50;
            color: white;
            font-family: Arial, sans-serif;
        }
        canvas {
            border: 2px solid #34495e;
            background-color: #87CEEB;
            display: block;
            margin: 20px auto;
        }
        .controls {
            text-align: center;
            margin: 20px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #2980b9;
        }
        .info {
            text-align: center;
            margin: 10px;
        }
    </style>
</head>
<body>
    <h1>漂浮障碍物系统测试</h1>
    
    <div class="controls">
        <button onclick="spawnFloatingObstacle()">生成漂浮障碍物</button>
        <button onclick="spawnGroundObstacle()">生成地面障碍物</button>
        <button onclick="clearObstacles()">清除所有障碍物</button>
        <button onclick="toggleDebug()">切换调试模式</button>
    </div>
    
    <canvas id="gameCanvas" width="800" height="400"></canvas>
    
    <div class="info">
        <p>紫色障碍物为漂浮障碍物，可以被射击摧毁</p>
        <p>红色/橙色障碍物为地面障碍物，不可被射击</p>
        <p>漂浮障碍物会有上下浮动的动画效果</p>
    </div>

    <!-- 加载游戏文件 -->
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/entities/entity.js"></script>
    <script src="js/entities/obstacle.js"></script>
    <script src="js/managers/obstacleManager.js"></script>
    <script src="js/renderer.js"></script>

    <script>
        // 测试脚本
        let canvas, renderer, obstacleManager;
        let lastTime = 0;
        let animationId;

        function init() {
            canvas = document.getElementById('gameCanvas');
            renderer = new Renderer(canvas);
            obstacleManager = new ObstacleManager();
            
            // 启用调试模式
            GameConfig.DEBUG = true;
            
            // 开始渲染循环
            requestAnimationFrame(gameLoop);
        }

        function gameLoop(currentTime) {
            const deltaTime = (currentTime - lastTime) / 1000;
            lastTime = currentTime;

            // 更新
            obstacleManager.update(deltaTime);

            // 渲染
            renderer.clear();
            
            // 绘制地面线
            renderer.drawRect(0, GameConfig.GROUND_Y, GameConfig.CANVAS_WIDTH, 2, '#34495e');
            
            // 绘制漂浮区域指示
            renderer.drawRect(0, GameConfig.FLOATING_OBSTACLE_MIN_Y, GameConfig.CANVAS_WIDTH, 
                            GameConfig.FLOATING_OBSTACLE_MAX_Y - GameConfig.FLOATING_OBSTACLE_MIN_Y, 
                            'rgba(155, 89, 182, 0.1)');
            
            // 渲染障碍物
            obstacleManager.render(renderer);
            
            // 显示说明
            renderer.drawText('漂浮区域', 10, GameConfig.FLOATING_OBSTACLE_MIN_Y + 20, '#9b59b6');
            renderer.drawText('地面', 10, GameConfig.GROUND_Y - 10, '#34495e');

            animationId = requestAnimationFrame(gameLoop);
        }

        function spawnFloatingObstacle() {
            obstacleManager.spawnFloatingObstacle();
        }

        function spawnGroundObstacle() {
            obstacleManager.spawnObstacle();
        }

        function clearObstacles() {
            obstacleManager.clearAllObstacles();
        }

        function toggleDebug() {
            GameConfig.DEBUG = !GameConfig.DEBUG;
        }

        // 初始化
        window.addEventListener('load', init);
    </script>
</body>
</html>